{"ast":null,"code":"import { useSyncExternalStore } from 'use-sync-external-store/shim';\nvar __DEV__ = process.env.NODE_ENV !== 'production';\nvar isInAction = false;\nvar run = function (fn) {\n  fn();\n};\nvar resso = function (obj) {\n  if (__DEV__ && Object.prototype.toString.call(obj) !== '[object Object]') {\n    throw new Error('object required');\n  }\n  var state = {};\n  var actions = {};\n  Object.keys(obj).forEach(function (key) {\n    var initVal = obj[key];\n    if (initVal instanceof Function) {\n      actions[key] = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n          args[_i] = arguments[_i];\n        }\n        isInAction = true;\n        var res = initVal.apply(void 0, args);\n        isInAction = false;\n        return res;\n      };\n      return;\n    }\n    var listeners = new Set();\n    state[key] = {\n      subscribe: function (listener) {\n        listeners.add(listener);\n        return function () {\n          return listeners.delete(listener);\n        };\n      },\n      getSnapshot: function () {\n        return obj[key];\n      },\n      setSnapshot: function (val) {\n        if (val !== obj[key]) {\n          obj[key] = val;\n          run(function () {\n            return listeners.forEach(function (listener) {\n              return listener();\n            });\n          });\n        }\n      },\n      useSnapshot: function () {\n        return useSyncExternalStore(state[key].subscribe, state[key].getSnapshot);\n      }\n    };\n  });\n  var setState = function (key, val) {\n    if (key in obj) {\n      if (key in state) {\n        var newVal = val instanceof Function ? val(obj[key]) : val;\n        state[key].setSnapshot(newVal);\n      } else if (__DEV__) {\n        throw new Error(\"'\".concat(key, \"' is a function, can not update\"));\n      }\n    } else if (__DEV__) {\n      throw new Error(\"'\".concat(key, \"' is not initialized in store\"));\n    }\n  };\n  return new Proxy(function () {\n    return undefined;\n  }, {\n    get: function (_, key) {\n      if (key in actions) {\n        return actions[key];\n      }\n      if (isInAction) {\n        return obj[key];\n      }\n      try {\n        return state[key].useSnapshot();\n      } catch (err) {\n        return obj[key];\n      }\n    },\n    set: function (_, key, val) {\n      setState(key, val);\n      return true;\n    },\n    apply: function (_, __, _a) {\n      var key = _a[0],\n        updater = _a[1];\n      setState(key, updater);\n    }\n  });\n};\nresso.config = function (_a) {\n  var batch = _a.batch;\n  run = batch;\n};\nexport { resso as default };","map":{"version":3,"names":["useSyncExternalStore","__DEV__","process","env","NODE_ENV","isInAction","run","fn","resso","obj","Object","prototype","toString","call","Error","state","actions","keys","forEach","key","initVal","Function","args","_i","arguments","length","res","apply","listeners","Set","subscribe","listener","add","delete","getSnapshot","setSnapshot","val","useSnapshot","setState","newVal","concat","Proxy","undefined","get","_","err","set","__","_a","updater","config","batch","default"],"sources":["/Users/seven/project/react/art/node_modules/resso/dist/resso.esm.js"],"sourcesContent":["import { useSyncExternalStore } from 'use-sync-external-store/shim';\n\nvar __DEV__ = process.env.NODE_ENV !== 'production';\nvar isInAction = false;\nvar run = function (fn) {\n    fn();\n};\nvar resso = function (obj) {\n    if (__DEV__ && Object.prototype.toString.call(obj) !== '[object Object]') {\n        throw new Error('object required');\n    }\n    var state = {};\n    var actions = {};\n    Object.keys(obj).forEach(function (key) {\n        var initVal = obj[key];\n        if (initVal instanceof Function) {\n            actions[key] = function () {\n                var args = [];\n                for (var _i = 0; _i < arguments.length; _i++) {\n                    args[_i] = arguments[_i];\n                }\n                isInAction = true;\n                var res = initVal.apply(void 0, args);\n                isInAction = false;\n                return res;\n            };\n            return;\n        }\n        var listeners = new Set();\n        state[key] = {\n            subscribe: function (listener) {\n                listeners.add(listener);\n                return function () { return listeners.delete(listener); };\n            },\n            getSnapshot: function () { return obj[key]; },\n            setSnapshot: function (val) {\n                if (val !== obj[key]) {\n                    obj[key] = val;\n                    run(function () { return listeners.forEach(function (listener) { return listener(); }); });\n                }\n            },\n            useSnapshot: function () {\n                return useSyncExternalStore(state[key].subscribe, state[key].getSnapshot);\n            },\n        };\n    });\n    var setState = function (key, val) {\n        if (key in obj) {\n            if (key in state) {\n                var newVal = val instanceof Function ? val(obj[key]) : val;\n                state[key].setSnapshot(newVal);\n            }\n            else if (__DEV__) {\n                throw new Error(\"'\".concat(key, \"' is a function, can not update\"));\n            }\n        }\n        else if (__DEV__) {\n            throw new Error(\"'\".concat(key, \"' is not initialized in store\"));\n        }\n    };\n    return new Proxy((function () { return undefined; }), {\n        get: function (_, key) {\n            if (key in actions) {\n                return actions[key];\n            }\n            if (isInAction) {\n                return obj[key];\n            }\n            try {\n                return state[key].useSnapshot();\n            }\n            catch (err) {\n                return obj[key];\n            }\n        },\n        set: function (_, key, val) {\n            setState(key, val);\n            return true;\n        },\n        apply: function (_, __, _a) {\n            var key = _a[0], updater = _a[1];\n            setState(key, updater);\n        },\n    });\n};\nresso.config = function (_a) {\n    var batch = _a.batch;\n    run = batch;\n};\n\nexport { resso as default };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}